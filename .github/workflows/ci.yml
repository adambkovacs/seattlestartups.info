name: CI - Build & Validate

on:
  push:
    branches: ["dev", "feature/**"]
  pull_request:
    branches: ["main", "dev"]

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      HUGO_VERSION: 0.140.0
    steps:
      - name: Install Hugo CLI
        run: |
          wget -O ${{ runner.temp }}/hugo.deb https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.deb \
          && sudo dpkg -i ${{ runner.temp }}/hugo.deb

      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0

      - name: Build with Hugo (test build)
        env:
          HUGO_CACHEDIR: ${{ runner.temp }}/hugo_cache
          HUGO_ENVIRONMENT: development
          TZ: America/Los_Angeles
        run: |
          hugo \
            --gc \
            --minify \
            --baseURL "https://seattlestartups.info/"

      - name: Check for build errors
        run: |
          echo "‚úÖ Hugo build successful"
          echo "üìÅ Generated files:"
          ls -la public/
          echo ""
          echo "üìä Build stats:"
          find public -type f | wc -l | xargs -I {} echo "  {} files generated"
          du -sh public/ | xargs -I {} echo "  {} total size"

      - name: Validate HTML (basic)
        run: |
          # Check that index.html exists and has content
          if [ -f "public/index.html" ]; then
            echo "‚úÖ index.html exists"
            head -20 public/index.html
          else
            echo "‚ùå index.html not found"
            exit 1
          fi
