{{ define "main" }}
<div class="relative">
  <!-- Hero Section - Editorial Style -->
  <section class="relative overflow-hidden py-12 lg:py-20 border-b border-overcast-200 dark:border-overcast-700">
    <div class="absolute inset-0 dots-pattern opacity-30 dark:opacity-10"></div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl">
        <!-- Breadcrumb -->
        {{ if .Parent }}
        <nav class="flex mb-6" aria-label="Breadcrumb">
          <ol class="flex items-center space-x-2 text-sm font-mono">
            <li><a href="{{ .Site.BaseURL }}" class="text-overcast-500 dark:text-overcast-400 hover:text-sound-600 dark:hover:text-sound-400 transition-colors">Home</a></li>
            <li class="text-overcast-300 dark:text-overcast-600">/</li>
            <li class="text-sound-600 dark:text-sound-400 font-medium">{{ .Title }}</li>
          </ol>
        </nav>
        {{ end }}

        <h1 class="font-display font-black text-4xl md:text-5xl lg:text-6xl text-overcast-900 dark:text-white mb-4 tracking-tight">
          {{ .Title }}
        </h1>

        <p class="text-lg md:text-xl text-overcast-600 dark:text-overcast-300 leading-relaxed mb-8 max-w-2xl">
          {{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}
        </p>

        <!-- Live Stats Bar -->
        <div class="flex flex-wrap items-center gap-6 text-sm font-mono text-overcast-500 dark:text-overcast-400">
          <div class="flex items-center gap-2">
            <span class="inline-block w-2 h-2 rounded-full bg-fir-500 animate-pulse"></span>
            <span id="resource-count" class="font-bold text-overcast-900 dark:text-white">0</span>
            <span>resources</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-overcast-300 dark:text-overcast-600">|</span>
            <span id="filtered-count" class="font-bold text-overcast-900 dark:text-white">0</span>
            <span>showing</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-overcast-300 dark:text-overcast-600">|</span>
            <button id="sort-toggle" class="flex items-center gap-1 hover:text-sound-600 dark:hover:text-sound-400 transition-colors cursor-pointer">
              <span id="sort-label">A → Z</span>
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Filter & Search Section -->
  <section class="sticky top-16 z-40 fog border-b border-overcast-200 dark:border-overcast-700 py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Search Bar -->
      <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
        <div class="relative flex-grow max-w-xl">
          <input type="search"
                 id="resource-search"
                 placeholder="Search resources, organizations, keywords..."
                 class="w-full px-4 py-3 pl-11 rounded-xl border-2 border-overcast-200 dark:border-overcast-700 bg-white dark:bg-overcast-800 focus:outline-none focus:border-sound-500 focus:ring-4 focus:ring-sound-100 dark:focus:ring-sound-900/50 transition-all duration-200 font-mono text-sm dark:text-white dark:placeholder-overcast-400">
          <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <kbd class="hidden sm:inline-flex absolute right-3 top-1/2 transform -translate-y-1/2 px-2 py-1 text-xs font-mono text-overcast-400 bg-overcast-100 rounded">⌘K</kbd>
        </div>

        <!-- Filter Toggle Button (Mobile) -->
        <button id="filter-toggle" class="lg:hidden flex items-center gap-2 px-4 py-3 rounded-xl border-2 border-overcast-200 bg-white hover:border-sound-300 transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
          </svg>
          <span class="font-medium text-sm">Filters</span>
          <span id="active-filter-count" class="hidden px-2 py-0.5 text-xs font-bold bg-sound-500 text-white rounded-full">0</span>
        </button>

        <!-- Clear Filters -->
        <button id="clear-filters" class="hidden items-center gap-2 px-4 py-2 text-sm font-medium text-sound-600 hover:text-sound-700 transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          Clear all
        </button>
      </div>

      <!-- Filter Pills -->
      <div id="filter-panel" class="hidden lg:flex flex-wrap gap-3 mt-4 pt-4 border-t border-overcast-100">
        <!-- Category Filter -->
        <div class="relative" data-filter-group="category">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 bg-white hover:border-sound-300 text-sm font-medium transition-colors">
            <span>Category</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-overcast-200 p-3 z-50">
            <div class="space-y-1 max-h-64 overflow-y-auto">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="all" class="category-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm">All Categories</span>
              </label>
              {{ range .Site.Taxonomies.categories }}
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="{{ .Page.Title | urlize }}" class="category-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">{{ .Page.Title }}</span>
                <span class="ml-auto text-xs text-overcast-400">({{ len .Pages }})</span>
              </label>
              {{ end }}
            </div>
          </div>
        </div>

        <!-- City Filter (Primary - City-focused navigation) -->
        <div class="relative" data-filter-group="city">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 bg-white hover:border-sound-300 text-sm font-medium transition-colors">
            <span>City</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-overcast-200 p-3 z-50">
            <div class="space-y-1 max-h-64 overflow-y-auto" id="city-filter-list">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="all" class="city-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm">All Cities</span>
              </label>
              {{ range $key, $value := .Site.Params.cities }}
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="{{ $key }}" class="city-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">{{ $value }}</span>
              </label>
              {{ end }}
            </div>
          </div>
        </div>

        <!-- County Filter (Secondary) -->
        <div class="relative" data-filter-group="county">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 bg-white hover:border-sound-300 text-sm font-medium transition-colors">
            <span>County</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-overcast-200 p-3 z-50">
            <div class="space-y-1">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="all" class="county-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm">All Counties</span>
              </label>
              {{ range $key, $value := .Site.Params.counties }}
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="{{ $key }}" class="county-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">{{ $value }}</span>
              </label>
              {{ end }}
            </div>
          </div>
        </div>

        <!-- Audience Filter (For Founders) -->
        <div class="relative" data-filter-group="audience">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 bg-white hover:border-sound-300 text-sm font-medium transition-colors">
            <span>For Founders</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-overcast-200 p-3 z-50">
            <div class="space-y-1">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="all" class="audience-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm">All Founders</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="bipoc" class="audience-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">BIPOC Founders</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="women" class="audience-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">Women Founders</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="veterans" class="audience-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">Veteran Founders</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="lgbtq" class="audience-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">LGBTQ+ Founders</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 cursor-pointer transition-colors">
                <input type="checkbox" value="immigrant" class="audience-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm">Immigrant Founders</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Industry Filter -->
        <div class="relative" data-filter-group="industry">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 dark:border-overcast-600 bg-white dark:bg-overcast-800 hover:border-sound-300 dark:hover:border-sound-600 text-sm font-medium transition-colors dark:text-overcast-200">
            <span>Industry</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-64 bg-white dark:bg-overcast-800 rounded-xl shadow-xl border border-overcast-200 dark:border-overcast-700 p-3 z-50">
            <div class="space-y-1 max-h-64 overflow-y-auto">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="all" class="industry-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm dark:text-overcast-200">All Industries</span>
              </label>
              {{ range $key, $value := .Site.Params.industries }}
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="{{ $key }}" class="industry-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm dark:text-overcast-200">{{ $value }}</span>
              </label>
              {{ end }}
            </div>
          </div>
        </div>

        <!-- Cost Filter -->
        <div class="relative" data-filter-group="cost">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 dark:border-overcast-600 bg-white dark:bg-overcast-800 hover:border-sound-300 dark:hover:border-sound-600 text-sm font-medium transition-colors dark:text-overcast-200">
            <span>Cost</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-48 bg-white dark:bg-overcast-800 rounded-xl shadow-xl border border-overcast-200 dark:border-overcast-700 p-3 z-50">
            <div class="space-y-1">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="radio" name="cost" value="all" class="cost-filter w-4 h-4 border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm dark:text-overcast-200">All</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="radio" name="cost" value="free" class="cost-filter w-4 h-4 border-overcast-300 text-sound-600 focus:ring-sound-500">
                <span class="text-sm dark:text-overcast-200">Free Only</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Journey Stage Filter -->
        <div class="relative" data-filter-group="stage">
          <button class="filter-dropdown-btn flex items-center gap-2 px-4 py-2 rounded-lg border border-overcast-200 dark:border-overcast-600 bg-white dark:bg-overcast-800 hover:border-sound-300 dark:hover:border-sound-600 text-sm font-medium transition-colors dark:text-overcast-200">
            <span>Your Stage</span>
            <svg class="w-4 h-4 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="filter-dropdown hidden absolute top-full left-0 mt-2 w-64 bg-white dark:bg-overcast-800 rounded-xl shadow-xl border border-overcast-200 dark:border-overcast-700 p-3 z-50">
            <div class="space-y-1">
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="all" class="stage-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500" checked>
                <span class="text-sm dark:text-overcast-200">All Stages</span>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="ideation" class="stage-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <div>
                  <span class="text-sm dark:text-overcast-200">Ideation</span>
                  <p class="text-xs text-overcast-400">Validating your idea</p>
                </div>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="starting" class="stage-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <div>
                  <span class="text-sm dark:text-overcast-200">Starting</span>
                  <p class="text-xs text-overcast-400">Building your company</p>
                </div>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="funding" class="stage-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <div>
                  <span class="text-sm dark:text-overcast-200">Funding</span>
                  <p class="text-xs text-overcast-400">Raising capital</p>
                </div>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="growing" class="stage-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <div>
                  <span class="text-sm dark:text-overcast-200">Growing</span>
                  <p class="text-xs text-overcast-400">Scaling operations</p>
                </div>
              </label>
              <label class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-overcast-50 dark:hover:bg-overcast-700 cursor-pointer transition-colors">
                <input type="checkbox" value="workspace" class="stage-filter w-4 h-4 rounded border-overcast-300 text-sound-600 focus:ring-sound-500">
                <div>
                  <span class="text-sm dark:text-overcast-200">Workspace</span>
                  <p class="text-xs text-overcast-400">Office & coworking</p>
                </div>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Active Filters Display -->
      <div id="active-filters" class="hidden flex flex-wrap gap-2 mt-4">
        <!-- Dynamically populated -->
      </div>
    </div>
  </section>

  <!-- Resources Grid -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    {{/* Collect all resources from YAML data files and sort alphabetically */}}
    {{ $allResources := slice }}
    {{ with $.Site.Data.resources }}
      {{ range $filename, $data := . }}
        {{ with $data.resources }}
          {{ range . }}
            {{ $allResources = $allResources | append . }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}

    {{/* Sort alphabetically by name */}}
    {{ $sortedResources := sort $allResources "name" }}

    {{ if $sortedResources }}
    <div id="resources-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
      {{ range $index, $resource := $sortedResources }}
        {{ partial "resource-card-enhanced.html" (dict "resource" $resource "index" $index) }}
      {{ end }}
    </div>

    <!-- No Results State -->
    <div id="no-results" class="hidden text-center py-20">
      <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-overcast-100 flex items-center justify-center">
        <svg class="w-10 h-10 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
      <h3 class="font-display font-bold text-xl text-overcast-700 mb-2">No resources found</h3>
      <p class="text-overcast-500 mb-6">Try adjusting your filters or search terms</p>
      <button onclick="clearAllFilters()" class="inline-flex items-center px-6 py-3 sun-break text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200">
        Clear all filters
      </button>
    </div>
    {{ else }}
    <!-- Empty State -->
    <div class="text-center py-20">
      <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-overcast-100 flex items-center justify-center">
        <svg class="w-10 h-10 text-overcast-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <h3 class="font-display font-bold text-xl text-overcast-700 mb-2">No resources yet</h3>
      <p class="text-overcast-500 mb-6">Be the first to contribute!</p>
      <a href="/submit/" class="inline-flex items-center px-6 py-3 sun-break text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Submit a Resource
      </a>
    </div>
    {{ end }}
  </section>

  <!-- CTA Section -->
  <section class="border-t border-overcast-200 dark:border-overcast-700 bg-overcast-50 dark:bg-overcast-800/50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center">
      <h2 class="font-display font-bold text-2xl md:text-3xl text-overcast-900 dark:text-white mb-4">
        Know a resource we missed?
      </h2>
      <p class="text-lg text-overcast-600 dark:text-overcast-300 mb-8 max-w-xl mx-auto">
        Help fellow founders by sharing free resources that helped you build your startup.
      </p>
      <a href="/submit/" class="inline-flex items-center px-8 py-4 sun-break text-white rounded-xl font-semibold text-lg shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-200">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Submit a Resource
      </a>
    </div>
  </section>
</div>

<!-- Advanced Filter & Search Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Elements
  const searchInput = document.getElementById('resource-search');
  const resourcesGrid = document.getElementById('resources-grid');
  const cards = resourcesGrid ? resourcesGrid.querySelectorAll('[data-resource-card]') : [];
  const resourceCount = document.getElementById('resource-count');
  const filteredCount = document.getElementById('filtered-count');
  const noResults = document.getElementById('no-results');
  const filterPanel = document.getElementById('filter-panel');
  const filterToggle = document.getElementById('filter-toggle');
  const clearFiltersBtn = document.getElementById('clear-filters');
  const activeFiltersDisplay = document.getElementById('active-filters');

  // Set total count
  if (resourceCount) resourceCount.textContent = cards.length;
  if (filteredCount) filteredCount.textContent = cards.length;

  // City filters are populated from Hugo params in the template
  // No need to dynamically populate them here

  // Filter state
  let filters = {
    search: '',
    categories: [],
    counties: [],
    cities: [],
    audiences: [],
    industries: [],
    stages: [],
    cost: 'all'
  };

  // Stage to category mapping
  const stageCategories = {
    'ideation': ['mentorship', 'education', 'events'],
    'starting': ['accelerators', 'mentorship', 'education', 'government'],
    'funding': ['funding', 'accelerators', 'competitions'],
    'growing': ['accelerators', 'mentorship', 'government'],
    'workspace': ['spaces', 'coworking', 'makerspaces']
  };

  // Dropdown toggles
  document.querySelectorAll('.filter-dropdown-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      const dropdown = this.nextElementSibling;
      const wasHidden = dropdown.classList.contains('hidden');

      // Close all dropdowns
      document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.add('hidden'));

      // Toggle this one
      if (wasHidden) dropdown.classList.remove('hidden');
    });
  });

  // Close dropdowns on click outside
  document.addEventListener('click', function() {
    document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.add('hidden'));
  });

  // Prevent dropdown close when clicking inside
  document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
    dropdown.addEventListener('click', e => e.stopPropagation());
  });

  // Mobile filter toggle
  if (filterToggle) {
    filterToggle.addEventListener('click', function() {
      filterPanel.classList.toggle('hidden');
      filterPanel.classList.toggle('flex');
    });
  }

  // Filter change handlers
  function handleFilterChange() {
    // Collect active filters
    filters.categories = Array.from(document.querySelectorAll('.category-filter:checked:not([value="all"])'))
      .map(cb => cb.value);
    filters.counties = Array.from(document.querySelectorAll('.county-filter:checked:not([value="all"])'))
      .map(cb => cb.value);
    filters.cities = Array.from(document.querySelectorAll('.city-filter:checked:not([value="all"])'))
      .map(cb => cb.value);
    filters.audiences = Array.from(document.querySelectorAll('.audience-filter:checked:not([value="all"])'))
      .map(cb => cb.value);
    filters.industries = Array.from(document.querySelectorAll('.industry-filter:checked:not([value="all"])'))
      .map(cb => cb.value);
    filters.stages = Array.from(document.querySelectorAll('.stage-filter:checked:not([value="all"])'))
      .map(cb => cb.value);
    filters.cost = document.querySelector('.cost-filter:checked')?.value || 'all';

    applyFilters();
    updateActiveFiltersDisplay();
    updateURL();
  }

  // Search handler
  if (searchInput) {
    searchInput.addEventListener('input', function() {
      filters.search = this.value.toLowerCase().trim();
      applyFilters();
    });

    // Keyboard shortcut
    document.addEventListener('keydown', function(e) {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        searchInput.focus();
      }
    });
  }

  // Apply all filters
  function applyFilters() {
    let visibleCount = 0;

    cards.forEach(card => {
      const title = (card.dataset.title || '').toLowerCase();
      const description = (card.dataset.description || '').toLowerCase();
      const category = (card.dataset.category || '').toLowerCase();
      const county = (card.dataset.county || '').toLowerCase();
      const city = (card.dataset.city || '').toLowerCase().replace(/\s+/g, '-');
      const audiences = (card.dataset.audiences || '').toLowerCase().split(',').filter(Boolean);
      const cost = (card.dataset.cost || '').toLowerCase();
      const organization = (card.dataset.organization || '').toLowerCase();

      let visible = true;

      // Search filter
      if (filters.search) {
        const searchTerms = filters.search.split(' ');
        visible = searchTerms.every(term =>
          title.includes(term) ||
          description.includes(term) ||
          category.includes(term) ||
          organization.includes(term)
        );
      }

      // Category filter
      if (visible && filters.categories.length > 0) {
        visible = filters.categories.includes(category);
      }

      // County filter
      if (visible && filters.counties.length > 0) {
        visible = filters.counties.some(c => county.includes(c));
      }

      // City filter
      if (visible && filters.cities.length > 0) {
        visible = filters.cities.includes(city);
      }

      // Audience filter
      if (visible && filters.audiences.length > 0) {
        visible = filters.audiences.some(a => audiences.includes(a));
      }

      // Industry filter
      if (visible && filters.industries.length > 0) {
        const industries = (card.dataset.industries || '').toLowerCase().split(',').filter(Boolean);
        visible = filters.industries.some(i => industries.includes(i));
      }

      // Stage filter (maps to categories)
      if (visible && filters.stages.length > 0) {
        const stageMatchCategories = filters.stages.flatMap(s => stageCategories[s] || []);
        visible = stageMatchCategories.some(c => category.includes(c));
      }

      // Cost filter
      if (visible && filters.cost === 'free') {
        visible = cost.includes('free');
      }

      card.style.display = visible ? '' : 'none';
      if (visible) visibleCount++;
    });

    // Update count
    if (filteredCount) filteredCount.textContent = visibleCount;

    // Show/hide no results
    if (noResults && resourcesGrid) {
      noResults.classList.toggle('hidden', visibleCount > 0);
      resourcesGrid.classList.toggle('hidden', visibleCount === 0);
    }

    // Show/hide clear button
    const hasActiveFilters = filters.search ||
      filters.categories.length > 0 ||
      filters.counties.length > 0 ||
      filters.cities.length > 0 ||
      filters.audiences.length > 0 ||
      filters.industries.length > 0 ||
      filters.stages.length > 0 ||
      filters.cost !== 'all';

    if (clearFiltersBtn) {
      clearFiltersBtn.classList.toggle('hidden', !hasActiveFilters);
      clearFiltersBtn.classList.toggle('flex', hasActiveFilters);
    }
  }

  // Update active filters display
  function updateActiveFiltersDisplay() {
    if (!activeFiltersDisplay) return;

    const tags = [];

    filters.categories.forEach(c => tags.push({ type: 'category', value: c, label: c }));
    filters.counties.forEach(c => tags.push({ type: 'county', value: c, label: c }));
    filters.cities.forEach(c => tags.push({ type: 'city', value: c, label: c }));
    filters.audiences.forEach(a => tags.push({ type: 'audience', value: a, label: a }));
    filters.industries.forEach(i => tags.push({ type: 'industry', value: i, label: i }));
    filters.stages.forEach(s => tags.push({ type: 'stage', value: s, label: s.charAt(0).toUpperCase() + s.slice(1) }));
    if (filters.cost !== 'all') tags.push({ type: 'cost', value: filters.cost, label: 'Free Only' });

    if (tags.length === 0) {
      activeFiltersDisplay.classList.add('hidden');
      return;
    }

    activeFiltersDisplay.classList.remove('hidden');
    activeFiltersDisplay.innerHTML = tags.map(tag => `
      <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-sound-100 text-sound-700">
        ${tag.label}
        <button onclick="removeFilter('${tag.type}', '${tag.value}')" class="ml-1 hover:text-sound-900">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </span>
    `).join('');
  }

  // Update URL with filter state
  function updateURL() {
    const params = new URLSearchParams();

    if (filters.search) params.set('q', filters.search);
    if (filters.categories.length) params.set('category', filters.categories.join(','));
    if (filters.counties.length) params.set('county', filters.counties.join(','));
    if (filters.cities.length) params.set('city', filters.cities.join(','));
    if (filters.audiences.length) params.set('audience', filters.audiences.join(','));
    if (filters.industries.length) params.set('industry', filters.industries.join(','));
    if (filters.stages.length) params.set('stage', filters.stages.join(','));
    if (filters.cost !== 'all') params.set('cost', filters.cost);

    const newURL = params.toString() ? `${window.location.pathname}?${params}` : window.location.pathname;
    history.replaceState(null, '', newURL);
  }

  // Load filters from URL
  function loadFiltersFromURL() {
    const params = new URLSearchParams(window.location.search);

    // Proper mapping of URL param names to filter object keys
    const filterKeyMap = {
      'category': 'categories',
      'county': 'counties',
      'city': 'cities',
      'audience': 'audiences',
      'industry': 'industries',
      'stage': 'stages'
    };

    if (params.get('q')) {
      filters.search = params.get('q');
      if (searchInput) searchInput.value = filters.search;
    }

    ['category', 'county', 'city', 'audience', 'industry', 'stage'].forEach(type => {
      const value = params.get(type);
      if (value) {
        const values = value.split(',');
        const filterKey = filterKeyMap[type];
        filters[filterKey] = values;

        // Uncheck "All" checkbox when specific filters are selected
        const allCheckbox = document.querySelector(`.${type}-filter[value="all"]`);
        if (allCheckbox) allCheckbox.checked = false;

        // Check the specific filter checkboxes
        values.forEach(v => {
          const checkbox = document.querySelector(`.${type}-filter[value="${v}"]`);
          if (checkbox) checkbox.checked = true;
        });
      }
    });

    if (params.get('cost')) {
      filters.cost = params.get('cost');
      const radio = document.querySelector(`.cost-filter[value="${filters.cost}"]`);
      if (radio) radio.checked = true;
    }

    applyFilters();
    updateActiveFiltersDisplay();
  }

  // Clear all filters
  window.clearAllFilters = function() {
    filters = { search: '', categories: [], counties: [], cities: [], audiences: [], industries: [], stages: [], cost: 'all' };

    if (searchInput) searchInput.value = '';
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.checked = cb.value === 'all';
    });
    document.querySelectorAll('.cost-filter').forEach(r => {
      r.checked = r.value === 'all';
    });

    applyFilters();
    updateActiveFiltersDisplay();
    updateURL();
  };

  // Remove single filter
  window.removeFilter = function(type, value) {
    // Proper mapping of URL param names to filter object keys
    const filterKeyMap = {
      'category': 'categories',
      'county': 'counties',
      'city': 'cities',
      'audience': 'audiences',
      'industry': 'industries',
      'stage': 'stages'
    };

    if (type === 'cost') {
      filters.cost = 'all';
      document.querySelector('.cost-filter[value="all"]').checked = true;
    } else {
      const filterKey = filterKeyMap[type];
      filters[filterKey] = filters[filterKey].filter(v => v !== value);
      const checkbox = document.querySelector(`.${type}-filter[value="${value}"]`);
      if (checkbox) checkbox.checked = false;

      // Re-check "All" if no specific filters remain
      if (filters[filterKey].length === 0) {
        const allCheckbox = document.querySelector(`.${type}-filter[value="all"]`);
        if (allCheckbox) allCheckbox.checked = true;
      }
    }
    applyFilters();
    updateActiveFiltersDisplay();
    updateURL();
  };

  // Attach filter change handlers
  document.querySelectorAll('.category-filter, .county-filter, .city-filter, .audience-filter, .industry-filter, .stage-filter, .cost-filter').forEach(input => {
    input.addEventListener('change', handleFilterChange);
  });

  // Clear filters button
  if (clearFiltersBtn) {
    clearFiltersBtn.addEventListener('click', clearAllFilters);
  }

  // Sort toggle
  const sortToggle = document.getElementById('sort-toggle');
  const sortLabel = document.getElementById('sort-label');
  let sortAsc = true;

  if (sortToggle && resourcesGrid) {
    sortToggle.addEventListener('click', function() {
      sortAsc = !sortAsc;
      sortLabel.textContent = sortAsc ? 'A → Z' : 'Z → A';

      const cardsArray = Array.from(cards);
      cardsArray.sort((a, b) => {
        const nameA = (a.dataset.title || '').toLowerCase();
        const nameB = (b.dataset.title || '').toLowerCase();
        return sortAsc ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
      });

      cardsArray.forEach(card => resourcesGrid.appendChild(card));
    });
  }

  // Initialize
  loadFiltersFromURL();
});
</script>
{{ end }}
